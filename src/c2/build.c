// WARNING: this file is auto-generated by the C2 compiler.
// Any changes you make might be lost!

#ifndef EXTERNAL_H
#define EXTERNAL_H

#if defined(__clang__)
#  pragma clang diagnostic ignored "-Wincompatible-library-redeclaration"
#  pragma clang diagnostic ignored "-Wunknown-warning-option"
#  pragma clang diagnostic ignored "-Wparentheses-equality"
#  pragma clang diagnostic ignored "-Wsometimes-uninitialized"
#  pragma clang diagnostic ignored "-Wtypedef-redefinition"
#  pragma clang diagnostic ignored "-Wstring-plus-int"
#  if (__clang_major__ >= 10)
#    define fallthrough  __attribute__((fallthrough))
#  endif
#elif defined(__GNUC__)
#  if (__GNUC__ >= 11)
#    define fallthrough  [[fallthrough]]
#  elif (__GNUC__ >= 7)
#    define fallthrough  __attribute__((fallthrough))
#  endif
#  pragma GCC diagnostic ignored "-Wmain"
#  if (__GNUC__ >= 10)
#    pragma GCC diagnostic ignored "-Wzero-length-bounds"
#  endif
#  if (__GNUC__ >= 7)
#    pragma GCC diagnostic ignored "-Wformat-overflow"
#    pragma GCC diagnostic ignored "-Wstringop-overflow"
#  endif
#endif

#ifndef fallthrough
#  define fallthrough
#endif

// --- internally added ---
typedef unsigned char bool;
typedef signed char int8_t;
typedef unsigned char uint8_t;
typedef signed short int16_t;
typedef unsigned short uint16_t;
typedef signed int int32_t;
typedef unsigned int uint32_t;
// FIXME: these should be target dependent
typedef signed long int64_t;
//typedef unsigned long uint64_t; // long is 32 bits on Windows !!!
typedef unsigned long long uint64_t;
typedef long ssize_t;
typedef unsigned long size_t;
#define true 1
#define false 0

#define NULL ((void*)0)
#define ARRAY_SIZE(x) (sizeof(x)/sizeof((x)[0]))
#define offsetof(type, member) __builtin_offsetof(type, member)
#define to_container(type, member, ptr) ((type*)((char*)(ptr) - offsetof(type, member)))
/*
int dprintf(int fd, const char *format, ...);
void abort(void);
static int c2_assert(const char* filename, int line, const char* funcname, const char* condstr) {
    dprintf(2, "%s:%d: function %s: Assertion failed: %s\n", filename, line, funcname, condstr);
    abort();
    return 0;
}
static int c2_strswitch(const char* s1, const char* s2) {
    if (!s1) return 0;  // nil
    if (!*s1) return 1; // ""
    int idx = 2;
    while (*s2) {
        unsigned len = *s2++ & 0xFF;
        for (unsigned i = 0;; i++) {
            if (i == len) {
                if (s1[i] == '\0')
                    return idx;
                break;
            }
            if (s1[i] != s2[i])
                break;
        }
        s2 += len;
        idx++;
    }
    return idx;
}
*/
#endif

// --- module c2 ---

typedef char c_char;

typedef int32_t c_int;

typedef int64_t c_long;

typedef uint64_t c_size;




// --- module varargs ---
// Note: this module is a special case and is custom generated
#define va_list __builtin_va_list
#define va_start __builtin_va_start
#define va_end __builtin_va_end


// --- module libc_time ---

c_long clock(void);


// --- module stdio ---

__attribute__((__format__(printf, 1, 2))) 
c_int printf(const c_char* __format, ...);


// --- module stdlib ---

void* malloc(c_size size);
void free(void* ptr);


// --- module sys_time ---



// --- module memtest ---

uint64_t memtest_seed = 50429807834l;

static const uint64_t memtest_multiplier = 25214903917l;

static const uint8_t memtest_addend = 11;

static const uint64_t memtest_mask = (((((uint64_t)1) << 48)) - 1);

static uint64_t memtest_rand(uint8_t bits);
static void memtest_reset_seed(void);
static void memtest_test_mem(uint8_t* memPtr, uint8_t memBits);
int32_t main(int32_t argc, char** argv);

static uint64_t memtest_rand(uint8_t bits)
{
   uint64_t nextSeed;
   nextSeed = ((((memtest_seed * memtest_multiplier) + memtest_addend)) & memtest_mask);
   memtest_seed = nextSeed;
   return (nextSeed >> ((48 - bits)));
}

static void memtest_reset_seed(void)
{
   memtest_seed = 50429807834l;
}

static void memtest_test_mem(uint8_t* memPtr, uint8_t memBits)
{
   memtest_reset_seed();
   uint32_t memSize = (((uint32_t)1) << memBits);
   uint64_t startTime = ((uint64_t)clock());
   for (uint32_t i = 0; (i < memSize); i++) {
      memPtr[i] = ((uint8_t)memtest_rand(8));
   }
   uint64_t elapsedTime = (((uint64_t)clock()) - startTime);
   printf("Sequential write: %llu\n", (elapsedTime));
   uint64_t result = 0;
   startTime = ((uint64_t)clock());
   for (uint32_t i = 0; (i < memSize); i++) {
      result += memPtr[memtest_rand(memBits)];
   }
   elapsedTime = (((uint64_t)clock()) - startTime);
   printf("Random read: %llu\n", (elapsedTime));
   startTime = ((uint64_t)clock());
   for (uint32_t i = 0; (i < memSize); i++) {
      uint8_t b = ((uint8_t)memtest_rand(8));
      memPtr[memtest_rand(memBits)] = b;
   }
   elapsedTime = (((uint64_t)clock()) - startTime);
   printf("Random write: %llu\n", (elapsedTime));
   startTime = ((uint64_t)clock());
   for (uint32_t i = 0; (i < memSize); i++) {
      result += memPtr[i];
   }
   elapsedTime = (((uint64_t)clock()) - startTime);
   printf("Sequential read: %llu\n", (elapsedTime));
   printf("Result: %llu\n", result);
   printf("\n");
}

int32_t main(int32_t argc, char** argv)
{
   printf("Language: C2\n");
   printf("Implementation: \n");
   printf("Compiler: \n");
   printf("Options: \n");
   printf("\n");
   uint8_t memBits = 30;
   uint8_t* memPtr = malloc((((uint64_t)1) << memBits));
   for (uint32_t i = 0; (i < 10); i++) {
      memtest_test_mem(memPtr, memBits);
   }
   free(memPtr);
   return 0;
}

